<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<title>Kho Nhanh</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#28a745">

<style>
body{font-family:Arial;background:#f2f2f2;padding:10px}
h2,h3{text-align:center}
input,button,select{width:100%;font-size:22px;padding:12px;margin:6px 0}
button{border:none;border-radius:8px;color:#fff}
.n{background:#28a745}.x{background:#dc3545}
.ex{background:#17a2b8}.del{background:#6c757d}
.warn{background:#ff9800}.edit{background:#ffc107;color:#000}
table{width:100%;background:#fff;border-collapse:collapse;margin-top:10px}
td,th{border:1px solid #ccc;padding:8px;font-size:17px;text-align:center}
.low{background:#ffd6d6}
.suggestBox{background:#fff;border:1px solid #ccc;max-height:160px;overflow:auto}
.suggestBox div{padding:8px;border-bottom:1px solid #eee}
.suggestBox div:hover{background:#e0f0ff}
</style>
</head>
<body>

<h2>ğŸ“¦ KHO NHANH</h2>

<input id="t" placeholder="Nháº­p tÃªn hÃ ng">
<div id="goiYHang" class="suggestBox"></div>
<select id="list"><option value="">-- Chá»n nhanh hÃ ng --</option></select>

<input id="s" type="number" placeholder="Sá»‘ lÆ°á»£ng">

<input id="dv" placeholder="ÄÆ¡n vá»‹">
<div id="goiYDV" class="suggestBox"></div>
<select id="listDV"><option value="">-- Chá»n nhanh Ä‘Æ¡n vá»‹ --</option></select>

<input id="kh" placeholder="TÃªn khÃ¡ch hÃ ng">
<div id="goiYKH" class="suggestBox"></div>
<select id="listKH"><option value="">-- Chá»n nhanh KH --</option></select>

<button class="n" onclick="nhap()">â• NHáº¬P</button>
<button class="x" onclick="xuat()">â– XUáº¤T</button>
<button class="del" onclick="xoa()">ğŸ—‘ï¸ XOÃ HÃ€NG</button>
<button class="ex" onclick="xuatExcel()">â¬‡ï¸ XUáº¤T EXCEL</button>
<button class="ex" onclick="xuatCSV()">â¬‡ï¸ XUáº¤T CSV</button>

<h3>ğŸ” Kiá»ƒm tra nhanh tá»“n kho</h3>
<input id="checkHang" placeholder="GÃµ tÃªn hÃ ng">
<div id="ketQuaTon" class="suggestBox"></div>

<table>
<tr><th>HÃ ng</th><th>Tá»“n</th><th>ÄÆ¡n vá»‹</th><th>Sá»­a</th></tr>
<tbody id="b"></tbody>
</table>

<h3>ğŸ“Š Tá»”NG XUáº¤T THEO KH</h3>
<table>
<tr><th>KhÃ¡ch hÃ ng</th><th>Tá»•ng SL</th></tr>
<tbody id="tongkh"></tbody>
</table>

<button class="warn" onclick="xoaLichSu()">âš ï¸ XOÃ TOÃ€N Bá»˜ Lá»ŠCH Sá»¬</button>
<button class="ex" onclick="saoLuu()">ğŸ’¾ SAO LÆ¯U</button>
<input type="file" id="fileRestore" accept=".json">

<h3>ğŸ•’ Lá»‹ch sá»­</h3>
<table>
<tr>
<th>Thá»i gian</th><th>HÃ ng</th><th>KH</th><th>Loáº¡i</th>
<th>SL</th><th>ÄÆ¡n vá»‹</th><th>Sá»­a</th>
</tr>
<tbody id="ls"></tbody>
</table>

<script>
let k = JSON.parse(localStorage.getItem("k")||"{}");
let h = JSON.parse(localStorage.getItem("h")||"[]");
let khs = JSON.parse(localStorage.getItem("khs")||"[]");
let dvs = JSON.parse(localStorage.getItem("dvs")||"[]");
let editIndex=null;

/* ===== CHá»ŒN NHANH ===== */
list.onchange=()=>{t.value=list.value;dv.value=k[list.value]?.dv||"";}
listKH.onchange=()=>kh.value=listKH.value;
listDV.onchange=()=>dv.value=listDV.value;

/* ===== Gá»¢I Ã ===== */
t.oninput=()=>{
 let q=t.value.toLowerCase();
 goiYHang.innerHTML=Object.keys(k).filter(i=>i.toLowerCase().includes(q))
 .map(i=>`<div onclick="t.value='${i}';dv.value=k['${i}'].dv;goiYHang.innerHTML=''">${i}</div>`).join("");
};
kh.oninput=()=>{
 let q=kh.value.toLowerCase();
 goiYKH.innerHTML=khs.filter(i=>i.toLowerCase().includes(q))
 .map(i=>`<div onclick="kh.value='${i}';goiYKH.innerHTML=''">${i}</div>`).join("");
};
dv.oninput=()=>{
 let q=dv.value.toLowerCase();
 goiYDV.innerHTML=dvs.filter(i=>i.toLowerCase().includes(q))
 .map(i=>`<div onclick="dv.value='${i}';goiYDV.innerHTML=''">${i}</div>`).join("");
};
checkHang.oninput=()=>{
 let q=checkHang.value.toLowerCase();
 ketQuaTon.innerHTML=Object.keys(k).filter(i=>i.toLowerCase().includes(q))
 .map(i=>`<div>ğŸ“¦ ${i}: ${k[i].sl} ${k[i].dv}</div>`).join("");
};

/* ===== LÆ¯U ===== */
function save(){
 localStorage.setItem("k",JSON.stringify(k));
 localStorage.setItem("h",JSON.stringify(h));
 localStorage.setItem("khs",JSON.stringify(khs));
 localStorage.setItem("dvs",JSON.stringify(dvs));
 render();
}

/* ===== NHáº¬P / XUáº¤T ===== */
function nhap(){
 let ten=t.value.trim(),sl=+s.value,d=dv.value.trim(),khach=kh.value.trim();
 if(!ten||sl<=0)return;
 if(!k[ten])k[ten]={sl:0,dv:d};
 k[ten].sl+=sl;k[ten].dv=d;
 if(khach&&!khs.includes(khach))khs.push(khach);
 if(d&&!dvs.includes(d))dvs.push(d);
 h.unshift({time:new Date().toLocaleString(),ten,kh:khach,loai:"Nháº­p",sl,dv:d});
 t.value=s.value=dv.value=kh.value="";
 save();
}
function xuat(){
 let ten=t.value.trim(),sl=+s.value,khach=kh.value.trim();
 if(!k[ten]||k[ten].sl<sl)return alert("KhÃ´ng Ä‘á»§ tá»“n");
 k[ten].sl-=sl;
 h.unshift({time:new Date().toLocaleString(),ten,kh:khach,loai:"Xuáº¥t",sl,dv:k[ten].dv});
 t.value=s.value=kh.value="";
 save();
}

/* ===== Sá»¬A ===== */
function suaHang(i){
 t.value=i; s.value=k[i].sl; dv.value=k[i].dv;
}
function suaLS(i){
 let e=h[i];editIndex=i;
 t.value=e.ten;s.value=e.sl;dv.value=e.dv;kh.value=e.kh;
}
function luuSua(){
 if(editIndex!==null){
  let e=h[editIndex];
  e.ten=t.value;e.sl=+s.value;e.dv=dv.value;e.kh=kh.value;
  editIndex=null;
  save();
 }
}

/* ===== XOÃ ===== */
function xoa(){if(t.value&&confirm("XoÃ¡ hÃ ng?")){delete k[t.value];save();}}
function xoaLichSu(){if(confirm("XoÃ¡ toÃ n bá»™ lá»‹ch sá»­?")){h=[];save();}}

/* ===== HIá»‚N THá»Š ===== */
function render(){
 list.innerHTML='<option value="">-- Chá»n nhanh hÃ ng --</option>';
 listKH.innerHTML='<option value="">-- Chá»n nhanh KH --</option>';
 listDV.innerHTML='<option value="">-- Chá»n nhanh Ä‘Æ¡n vá»‹ --</option>';
 b.innerHTML="";
 for(let i in k){
  list.innerHTML+=`<option>${i}</option>`;
  if(k[i].dv&&!dvs.includes(k[i].dv))dvs.push(k[i].dv);
  b.innerHTML+=`<tr class="${k[i].sl<5?'low':''}">
  <td>${i}</td><td>${k[i].sl}</td><td>${k[i].dv}</td>
  <td><button class="edit" onclick="suaHang('${i}')">âœï¸</button></td></tr>`;
 }
 dvs.forEach(i=>listDV.innerHTML+=`<option>${i}</option>`);
 khs.forEach(i=>listKH.innerHTML+=`<option>${i}</option>`);
 let tong={};
 h.forEach(i=>{if(i.loai==="Xuáº¥t"&&i.kh)tong[i.kh]=(tong[i.kh]||0)+i.sl});
 tongkh.innerHTML=Object.keys(tong).map(i=>`<tr><td>${i}</td><td>${tong[i]}</td></tr>`).join("");
 ls.innerHTML=h.map((i,idx)=>`<tr>
 <td>${i.time}</td><td>${i.ten}</td><td>${i.kh}</td><td>${i.loai}</td>
 <td>${i.sl}</td><td>${i.dv}</td>
 <td><button class="edit" onclick="suaLS(${idx})">âœï¸</button></td></tr>`).join("");
}

render();
</script>
</body>
</html>
