<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ğŸ“¦ KHO NHANH</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body{font-family:-apple-system,Arial;background:#f2f2f2;padding:10px}
h2,h3{text-align:center}
input,button,select{width:100%;font-size:20px;padding:10px;margin:6px 0}
button{border:none;border-radius:8px;color:#fff}
.n{background:#28a745}.x{background:#dc3545}
.ex{background:#17a2b8}.del{background:#6c757d}
.warn{background:#ff9800}.print{background:#343a40}
.edit{background:#ffc107;color:#000}
table{width:100%;background:#fff;border-collapse:collapse;margin-top:10px}
td,th{border:1px solid #ccc;padding:6px;font-size:15px;text-align:center}
.low{background:#ffd6d6}
.thumb{width:70px;height:70px;object-fit:cover;border-radius:6px}

@media print{
 body *{display:none}
 #printArea,#printArea *{display:block}
}
</style>
</head>

<body>

<h2>ğŸ“¦ KHO NHANH</h2>

<input id="t" placeholder="TÃªn hÃ ng">
<input id="s" type="number" placeholder="Sá»‘ lÆ°á»£ng">
<input id="dv" placeholder="ÄÆ¡n vá»‹">
<input id="kh" placeholder="KhÃ¡ch hÃ ng">

<button class="n" onclick="themVaoPhieu()">â• THÃŠM VÃ€O PHIáº¾U</button>

<h3>ğŸ§¾ PHIáº¾U XUáº¤T</h3>
<table>
<tr><th>HÃ ng</th><th>SL</th><th>ÄV</th><th>X</th></tr>
<tbody id="phieuBody"></tbody>
</table>

<p><b>Tá»”NG SL:</b> <span id="tongSL">0</span></p>

<button class="x" onclick="chotPhieu()">âœ… CHá»T PHIáº¾U</button>
<button class="warn" onclick="huyPhieu()">âŒ HUá»¶ PHIáº¾U</button>
<button class="print" onclick="inPDF()">ğŸ–¨ï¸ IN / PDF</button>

<hr>

<h3>ğŸ“¦ Tá»’N KHO</h3>
<table>
<tr><th>HÃ ng</th><th>Tá»“n</th><th>ÄV</th><th>áº¢nh</th></tr>
<tbody id="b"></tbody>
</table>

<input type="file" id="imgInput" accept="image/*" hidden>

<!-- IN -->
<div id="printArea">
 <div style="text-align:center">
  <img src="logo.png" style="max-height:80px"><br>
  <b>Cá»¬A HÃ€NG ABC</b><br>
  ÄT: 0909 000 000
 </div>
 <hr>
 <p>MÃ£ phiáº¿u: <b id="pMa"></b></p>
 <p>NgÃ y: <span id="pNgay"></span></p>
 <p>KhÃ¡ch hÃ ng: <span id="pKH"></span></p>

 <table>
  <tr><th>HÃ ng</th><th>SL</th><th>ÄV</th></tr>
  <tbody id="pBody"></tbody>
 </table>

 <p><b>Tá»•ng SL:</b> <span id="pTong"></span></p>
 <br>
 <p>NgÆ°á»i giao _____________ &nbsp;&nbsp; NgÆ°á»i nháº­n _____________</p>
</div>

<script>
let k=JSON.parse(localStorage.getItem("k")||"{}");
let phieu=[];
let soPhieu=+localStorage.getItem("soPhieu")||1;

function themVaoPhieu(){
 if(!t.value||s.value<=0)return alert("Thiáº¿u dá»¯ liá»‡u");
 if(!k[t.value]||k[t.value].sl<s.value)return alert("KhÃ´ng Ä‘á»§ tá»“n");
 phieu.push({ten:t.value,sl:+s.value,dv:k[t.value].dv});
 renderPhieu();
}

function renderPhieu(){
 phieuBody.innerHTML="";
 let tong=0;
 phieu.forEach((i,idx)=>{
  tong+=i.sl;
  phieuBody.innerHTML+=`
   <tr>
    <td>${i.ten}</td><td>${i.sl}</td><td>${i.dv}</td>
    <td><button onclick="phieu.splice(${idx},1);renderPhieu()">âŒ</button></td>
   </tr>`;
 });
 tongSL.textContent=tong;
}

function chotPhieu(){
 if(!phieu.length)return alert("ChÆ°a cÃ³ hÃ ng");
 phieu.forEach(i=>k[i.ten].sl-=i.sl);
 localStorage.setItem("k",JSON.stringify(k));
 localStorage.setItem("soPhieu",++soPhieu);
 alert("âœ… ÄÃ£ chá»‘t phiáº¿u");
 phieu=[];
 renderPhieu();renderKho();
}

function huyPhieu(){
 if(confirm("Huá»· phiáº¿u hiá»‡n táº¡i?")){
  phieu=[];renderPhieu();
 }
}

function inPDF(){
 pMa.textContent="PX-"+String(soPhieu).padStart(4,"0");
 pNgay.textContent=new Date().toLocaleDateString("vi-VN");
 pKH.textContent=kh.value;
 pBody.innerHTML=phieu.map(i=>`<tr><td>${i.ten}</td><td>${i.sl}</td><td>${i.dv}</td></tr>`).join("");
 pTong.textContent=tongSL.textContent;
 window.print();
}

function renderKho(){
 b.innerHTML="";
 for(let i in k){
  b.innerHTML+=`
  <tr class="${k[i].sl<5?'low':''}">
   <td>${i}</td><td>${k[i].sl}</td><td>${k[i].dv}</td>
   <td>${k[i].img?`<img src="${k[i].img}" class="thumb">`:""}</td>
  </tr>`;
 }
}

renderKho();
</script>
</body>
</html>
